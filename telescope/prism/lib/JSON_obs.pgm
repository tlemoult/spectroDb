

test_write_JSON_Observation:

WorkDir$="c:\ccd\"
NomObjet$="P cyg"
AlphaObjet$="12h45d89s"
DeltaObjet$="+38d23m65s"
ProjectObject$="Bess"
TempCameraSpectre=5
binCameraSpectre=2
SPECTROGRAPHE$="ESHEL"
IsRef$="false"
currentStatusObs$="started"
gosub write_JSON_Observation:
exit


write_JSON_Observation:

	Open_FileTxt_For_Rewrite fileJSON WorkDir$+"observation.json"
	Print "Ecris le fichier JSON avec les details de l objet: "+NomObjet$

	WriteFileTxt fileJSON "{"
	WriteFileTxt fileJSON " ""Comment"": ""acquisition JSON file generated by PRISM at end of acquisition"", "
	WriteFileTxt fileJSON " ""jsonType"": ""acquisitionFile"", "
	WriteFileTxt fileJSON " ""formatVersion"": ""0.0.1"",  "
	WriteFileTxt fileJSON ""

	JSONLINE$="  ""statusObs"":"""+currentStatusObs$+""","
	WriteFileTxt fileJSON JSONLINE$
	
	WriteFileTxt fileJSON " ""target"": {"

	JSONLINE$="    ""isRef"":"+IsRef$+","
	WriteFileTxt fileJSON JSONLINE$

	JSONLINE$="     ""objname"": [ """+NomObjet$+"""],"
	WriteFileTxt fileJSON  JSONLINE$

	WriteFileTxt fileJSON "     ""coord"": {  "
	JSONLINE$="       ""ra"" :"""+AlphaObjet$+""","
	WriteFileTxt fileJSON  JSONLINE$
	JSONLINE$="       ""dec"" :"""+DeltaObjet$+""","
	WriteFileTxt fileJSON  JSONLINE$
	WriteFileTxt fileJSON "       ""equinox"": ""J2000"" "	
	WriteFileTxt fileJSON "     }"
	WriteFileTxt fileJSON "  },"
	WriteFileTxt fileJSON ""
	WriteFileTxt fileJSON "  ""project"": """+ProjectObject$+""", "
    WriteFileTxt fileJSON ""
	WriteFileTxt fileJSON "  ""instrument"": {"

	WriteFileTxt fileJSON "     ""telescop"": ""Celestron C14"", "
	WriteFileTxt fileJSON "     ""diameter"": 0.356, "
	WriteFileTxt fileJSON "     ""detname"": ""ATIK460"","
	WriteFileTxt fileJSON "     ""guideDetname"": ""ATIK314"","
	
	if SPECTROGRAPHE$="ESHEL" then
	WriteFileTxt fileJSON "     ""configName"": ""C14 eShel ATIK460"", "
	WriteFileTxt fileJSON "     ""spectro"": ""eShel"", "
	WriteFileTxt fileJSON "     ""resol"": 11000, "
	ENDIF

	if SPECTROGRAPHE$="LISA" then
	WriteFileTxt fileJSON "     ""configname"": ""C14 red063 LISA#127 Slit35 ATIK314L+"", "
	WriteFileTxt fileJSON "     ""spectro"": ""LISA"", "
	WriteFileTxt fileJSON "     ""resol"": 800, "
	ENDIF

	if SPECTROGRAPHE$="ALPY" then
	WriteFileTxt fileJSON "     ""configname"": ""C14 F5 ALPY ATIK314L+"", "
	WriteFileTxt fileJSON "     ""spectro"": ""ALPY"", "
	WriteFileTxt fileJSON "     ""resol"": 600, "
	ENDIF
	
	STR TempCameraSpectre TempCameraSpectre$
	WriteFileTxt fileJSON "     ""TemperatureCCD"":"+TempCameraSpectre$+","
	STR binCameraSpectre binCameraSpectre$
	WriteFileTxt fileJSON "     ""BinCCD"":"+binCameraSpectre$
	WriteFileTxt fileJSON "     },"
	
	WriteFileTxt fileJSON "		""site"": {"
	WriteFileTxt fileJSON "		""name"": ""Chelles"","
	WriteFileTxt fileJSON "		""country"": ""France"","
	WriteFileTxt fileJSON "		""lat"": ""48 52 49"","
	WriteFileTxt fileJSON "		""lon"": ""02 34 55"","
	WriteFileTxt fileJSON "		""alt"": "30","
	WriteFileTxt fileJSON "		""UAIcode"": ""C61"" "
	WriteFileTxt fileJSON "     },"
	
	WriteFileTxt fileJSON "   ""observer"": {"
	WriteFileTxt fileJSON "		""firstName"":""Thierry"","
	WriteFileTxt fileJSON "		""lastName"":""Lemoult"","
	WriteFileTxt fileJSON "		""email"":""thierry.lemoult@gmail.com"","
	WriteFileTxt fileJSON "		""alias"": ""Thierry Lemoult"" "
	WriteFileTxt fileJSON "		}"

	if currentStatusObs$="finished" then
		STR iacqu nbExposure$
		STR exposure exposure$
		TotalExposure=exposure*iacqu
		STR  TotalExposure TotalExposure$
		WriteFileTxt fileJSON ","
		WriteFileTxt fileJSON "  ""obsConfig"": {"
		WriteFileTxt fileJSON "		""NbExposure"":"+nbExposure$+","
		WriteFileTxt fileJSON "		""ExposureTime"":"+exposure$+","
		WriteFileTxt fileJSON "		""TotalExposure"":"+TotalExposure$
		WriteFileTxt fileJSON "		}"
	endif


	WriteFileTxt fileJSON "}"
	CloseFileTxt fileJSON

	
	Open_FileTxt_For_Rewrite fileNewRaw DirectorySignals$+"\newRawData"
	WriteFileTxt fileNewRaw "dummy"
	CloseFileTxt fileNewRaw
		
	
	RETURN

	
